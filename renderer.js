(()=>{function g(t){return{all:t=t||new Map,on:function(e,s){var i=t.get(e);i&&i.push(s)||t.set(e,[s])},off:function(e,s){var i=t.get(e);i&&i.splice(i.indexOf(s)>>>0,1)},emit:function(e,s){(t.get(e)||[]).slice().map(function(i){i(s)}),(t.get("*")||[]).slice().map(function(i){i(e,s)})}}}var l=class{constructor({interval:e=1e3,stopwatch:s=!1}={}){this._duration=0,this._endTime=0,this._pauseTime=0,this._status="stopped",this._emitter=g(),this.tick=()=>{this.status!=="paused"&&(Date.now()>=this._endTime?(this.stop(),this._emitter.emit("tick",this._stopwatch?this._duration:0),this._emitter.emit("done")):this._emitter.emit("tick",this.time))},this._interval=e,this._stopwatch=s}start(e,s){if(this.status==="stopped"){if(e==null)throw new TypeError("Must provide duration parameter");this._duration=e,this._endTime=Date.now()+e,this._changeStatus("running"),this._emitter.emit("tick",this._stopwatch?0:this._duration),this._timeoutID=setInterval(this.tick,s||this._interval)}}stop(){this._timeoutID&&clearInterval(this._timeoutID),this._changeStatus("stopped")}pause(){this.status==="running"&&(this._pauseTime=Date.now(),this._changeStatus("paused"))}resume(){this.status==="paused"&&(this._endTime+=Date.now()-this._pauseTime,this._pauseTime=0,this._changeStatus("running"))}_changeStatus(e){this._status=e,this._emitter.emit("statusChanged",this.status)}get time(){if(this.status==="stopped")return 0;let e=this.status==="paused"?this._pauseTime:Date.now(),s=this._endTime-e;return this._stopwatch?this._duration-s:s}get duration(){return this._duration}get status(){return this._status}on(e,s){this._emitter.on(e,s)}off(e,s){this._emitter.off(e,s)}},_=l;var f=document.querySelector("[data-app]"),v=document.querySelector('[data-action="start"]'),$=document.querySelector('[data-action="stop"]'),n=document.querySelector('[data-element="slider"]'),k=!0,T=new Audio(`${globalThis.mater.appPath}/wav/windup.wav`),S=new Audio(`${globalThis.mater.appPath}/wav/click.wav`),y=new Audio(`${globalThis.mater.appPath}/wav/ding.wav`),r="",w=0,m=25,b=5,a=new _,c=t=>t*60*1e3,L=t=>t/60/1e3,M=()=>r==="breaking"?b:m,D=()=>r==="breaking"?100:500,h=t=>{t.currentTime=0,k&&t.play()},o=t=>{f.classList.remove("is-stopped","is-working","is-breaking"),f.classList.add(`is-${t}`),r=t};o("stopped");var I=(t,e)=>{let{platform:s,appPath:i}=globalThis.mater,d=e==="breaking"?"-break":"",u;switch(s){case"darwin":{u=`${i}/img/template/icon-${t}${d}-Template.png`;break}case"win32":{u=`${i}/img/ico/icon-${t}${d}.ico`;break}default:u=`${i}/img/png/icon-${t}${d}.png`}globalThis.mater.setTrayIcon(u)},p=t=>{w=Math.ceil(L(t)),I(w,r)};p(0);document.addEventListener("keydown",t=>{t.key==="Escape"&&globalThis.mater.hideWindow()});v.addEventListener("click",()=>{h(T),a.start(c(m)),o("working"),n.classList.add("is-resetting-work"),setTimeout(()=>n.classList.remove("is-resetting-work"),1e3)});$.addEventListener("click",()=>{h(S),a.stop(),o("stopped")});a.on("tick",t=>{let e=M(),s=D(),i=Math.ceil(s*t/c(e));n.style.transform=`translateX(-${i}px)`,p(t)});a.on("done",()=>{h(y),p(0),globalThis.mater.showWindow(),setTimeout(()=>{h(T),r==="working"?(o("breaking"),a.start(c(b)),n.classList.add("is-resetting-break"),setTimeout(()=>n.classList.remove("is-resetting-break"),1e3)):(o("working"),a.start(c(m)),n.classList.add("is-resetting-work"),setTimeout(()=>n.classList.remove("is-resetting-work"),1e3))},2e3)});globalThis.mater.onToggleSound(t=>{k=t});})();
